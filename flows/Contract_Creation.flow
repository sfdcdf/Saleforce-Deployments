<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata">
    <assignments>
        <name>Assign_values_to_asset_variables</name>
        <label>Assign values to asset variables</label>
        <locationX>576</locationX>
        <locationY>157</locationY>
        <assignmentItems>
            <assignToReference>varloopsobjasset.AccountId</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>varsobjOppty.AccountId</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>varloopsobjasset.Product2Id</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>varLoopId.Product2Id</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>varloopsobjasset.Quantity</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>varLoopId.Quantity</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>varloopsobjasset.Price</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>varLoopId.UnitPrice</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>varloopsobjasset.PurchaseDate</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>varsobjOppty.CloseDate</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>varloopsobjasset.Status</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>Purchased</stringValue>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>varloopsobjasset.Description</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>varLoopId.Description</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>varloopsobjasset.Name</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>varLoopId.Name</elementReference>
            </value>
        </assignmentItems>
    </assignments>
    <assignments>
        <name>Assignment_Collection_Record</name>
        <label>Assignment-Collection Record</label>
        <locationX>571</locationX>
        <locationY>288</locationY>
        <assignmentItems>
            <assignToReference>sobjcollReadytoCreateAsset</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>varloopsobjasset</elementReference>
            </value>
        </assignmentItems>
    </assignments>
    <description>Creates a contract from a closed/won oppty along with assets from the oppty line items.</description>
    <formulas>
        <name>forContractName</name>
        <dataType>String</dataType>
        <expression>{!varsobjOppty.Name}+&quot; &quot;+TEXT({!varsobjOppty.CloseDate})</expression>
    </formulas>
    <interviewLabel>Contract Creation {!$Flow.CurrentDateTime}</interviewLabel>
    <label>WBN IL Contract Creation</label>
    <loops>
        <name>Looping_Oppty_Line_Items</name>
        <label>Looping Oppty Line Items</label>
        <locationX>375</locationX>
        <locationY>171</locationY>
        <assignNextValueToReference>varLoopId</assignNextValueToReference>
        <collectionReference>sobjcollOpptyLineItem</collectionReference>
        <iterationOrder>Asc</iterationOrder>
    </loops>
    <processType>AutoLaunchedFlow</processType>
    <recordCreates>
        <name>Create_Contract</name>
        <label>Create Contract</label>
        <locationX>56</locationX>
        <locationY>154</locationY>
        <assignRecordIdToReference>varContractId</assignRecordIdToReference>
        <connector>
            <targetReference>Contract_Activation</targetReference>
        </connector>
        <inputAssignments>
            <field>AccountId</field>
            <value>
                <elementReference>varsobjOppty.AccountId</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>ContractTerm</field>
            <value>
                <elementReference>varsobjOppty.Contract_Term_in_months__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Contract_Oppty__c</field>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Name</field>
            <value>
                <elementReference>forContractName</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Opportunity__c</field>
            <value>
                <elementReference>varOpptyId</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>StartDate</field>
            <value>
                <elementReference>varsobjOppty.CloseDate</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Status</field>
            <value>
                <stringValue>Draft</stringValue>
            </value>
        </inputAssignments>
        <object>Contract</object>
    </recordCreates>
    <recordLookups>
        <name>Get_Oppty</name>
        <label>Get Oppty</label>
        <locationX>60</locationX>
        <locationY>35</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Create_Contract</targetReference>
        </connector>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>varOpptyId</elementReference>
            </value>
        </filters>
        <object>Opportunity</object>
        <outputAssignments>
            <assignToReference>varsobjOppty.AccountId</assignToReference>
            <field>AccountId</field>
        </outputAssignments>
        <outputAssignments>
            <assignToReference>varsobjOppty.CloseDate</assignToReference>
            <field>CloseDate</field>
        </outputAssignments>
        <outputAssignments>
            <assignToReference>varsobjOppty.Contract_Term_in_months__c</assignToReference>
            <field>Contract_Term_in_months__c</field>
        </outputAssignments>
        <outputAssignments>
            <assignToReference>varsobjOppty.Id</assignToReference>
            <field>Id</field>
        </outputAssignments>
        <outputAssignments>
            <assignToReference>varsobjOppty.Name</assignToReference>
            <field>Name</field>
        </outputAssignments>
    </recordLookups>
    <recordLookups>
        <name>Get_Oppty_Line_Items</name>
        <label>Get Oppty Line Items</label>
        <locationX>266</locationX>
        <locationY>379</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <filters>
            <field>OpportunityId</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>varOpptyId</elementReference>
            </value>
        </filters>
        <object>OpportunityLineItem</object>
        <outputReference>sobjcollOpptyLineItem</outputReference>
        <queriedFields>UnitPrice</queriedFields>
        <queriedFields>Quantity</queriedFields>
        <queriedFields>PricebookEntryId</queriedFields>
        <queriedFields>Name</queriedFields>
        <queriedFields>Description</queriedFields>
        <queriedFields>Converted_to_Asset__c</queriedFields>
    </recordLookups>
    <recordUpdates>
        <name>Set_Contract_Auto_Create_True</name>
        <label>Set Contract Auto Create True</label>
        <locationX>62</locationX>
        <locationY>372</locationY>
        <connector>
            <targetReference>Get_Oppty_Line_Items</targetReference>
        </connector>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>varOpptyId</elementReference>
            </value>
        </filters>
        <inputAssignments>
            <field>Contract_Auto_Created__c</field>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </inputAssignments>
        <object>Opportunity</object>
    </recordUpdates>
    <startElementReference>Get_Oppty</startElementReference>
    <status>Obsolete</status>
    <subflows>
        <name>Contract_Activation</name>
        <label>Contract Activation</label>
        <locationX>162</locationX>
        <locationY>258</locationY>
        <connector>
            <targetReference>Set_Contract_Auto_Create_True</targetReference>
        </connector>
        <flowName>SubFlow_Contract_Activation</flowName>
        <inputAssignments>
            <name>subvarContractId</name>
            <value>
                <elementReference>varContractId</elementReference>
            </value>
        </inputAssignments>
    </subflows>
    <variables>
        <name>assignInsideLoop</name>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
        <objectType>OpportunityLineItem</objectType>
    </variables>
    <variables>
        <name>sobjcollOpptyLineItem</name>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
        <objectType>OpportunityLineItem</objectType>
    </variables>
    <variables>
        <name>sobjcollReadytoCreateAsset</name>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
        <objectType>Asset</objectType>
    </variables>
    <variables>
        <name>varContractId</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
    </variables>
    <variables>
        <name>varLoopId</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
        <objectType>OpportunityLineItem</objectType>
    </variables>
    <variables>
        <name>varloopsobjasset</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
        <objectType>Asset</objectType>
    </variables>
    <variables>
        <name>varOpptyId</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
    </variables>
    <variables>
        <name>varsobjOppty</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
        <objectType>Opportunity</objectType>
    </variables>
</Flow>
